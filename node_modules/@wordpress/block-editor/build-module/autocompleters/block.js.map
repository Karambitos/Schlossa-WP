{"version":3,"sources":["@wordpress/block-editor/src/autocompleters/block.js"],"names":["noop","map","useSelect","createBlock","useMemo","searchBlockItems","useBlockTypesState","includeVariationsInInserterItems","BlockIcon","createBlocksFromInnerBlocksTemplate","innerBlocksTemplate","name","attributes","innerBlocks","createBlockCompleter","className","triggerPrefix","useItems","filterValue","select","getSelectedBlockClientId","getBlockName","getBlockInsertionPoint","selectedBlockClientId","selectedBlockName","rootClientId","items","categories","collections","filteredItems","filter","item","options","blockItem","title","icon","isDisabled","key","id","value","label","allowContext","before","after","test","getOptionCompletion","inserterItem","initialAttributes","action"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop, map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { createBlock } from '@wordpress/blocks';\nimport { useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { searchBlockItems } from '../components/inserter/search-items';\nimport useBlockTypesState from '../components/inserter/hooks/use-block-types-state';\nimport { includeVariationsInInserterItems } from '../components/inserter/utils';\nimport BlockIcon from '../components/block-icon';\n\nconst createBlocksFromInnerBlocksTemplate = ( innerBlocksTemplate ) => {\n\treturn map(\n\t\tinnerBlocksTemplate,\n\t\t( [ name, attributes, innerBlocks = [] ] ) =>\n\t\t\tcreateBlock(\n\t\t\t\tname,\n\t\t\t\tattributes,\n\t\t\t\tcreateBlocksFromInnerBlocksTemplate( innerBlocks )\n\t\t\t)\n\t);\n};\n\n/** @typedef {import('@wordpress/block-editor').WPEditorInserterItem} WPEditorInserterItem */\n\n/** @typedef {import('@wordpress/components').WPCompleter} WPCompleter */\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @param {Object} props                                   Component props.\n * @param {string} [props.getBlockInsertionParentClientId] Client ID of the parent.\n * @param {string} [props.getInserterItems]                Inserter items for parent.\n * @param {string} [props.getSelectedBlockName]            Name of selected block or null.\n *\n * @return {WPCompleter} A blocks completer.\n */\nfunction createBlockCompleter() {\n\treturn {\n\t\tname: 'blocks',\n\t\tclassName: 'block-editor-autocompleters__block',\n\t\ttriggerPrefix: '/',\n\n\t\tuseItems( filterValue ) {\n\t\t\tconst { rootClientId, selectedBlockName } = useSelect(\n\t\t\t\t( select ) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tgetSelectedBlockClientId,\n\t\t\t\t\t\tgetBlockName,\n\t\t\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\t\t} = select( 'core/block-editor' );\n\t\t\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\t\t\t\treturn {\n\t\t\t\t\t\tselectedBlockName: selectedBlockClientId\n\t\t\t\t\t\t\t? getBlockName( selectedBlockClientId )\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\trootClientId: getBlockInsertionPoint().rootClientId,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t[]\n\t\t\t);\n\t\t\tconst [ items, categories, collections ] = useBlockTypesState(\n\t\t\t\trootClientId,\n\t\t\t\tnoop\n\t\t\t);\n\n\t\t\tconst filteredItems = useMemo( () => {\n\t\t\t\treturn searchBlockItems(\n\t\t\t\t\titems,\n\t\t\t\t\tcategories,\n\t\t\t\t\tcollections,\n\t\t\t\t\tfilterValue\n\t\t\t\t).filter( ( item ) => item.name !== selectedBlockName );\n\t\t\t}, [\n\t\t\t\tfilterValue,\n\t\t\t\tselectedBlockName,\n\t\t\t\titems,\n\t\t\t\tcategories,\n\t\t\t\tcollections,\n\t\t\t] );\n\n\t\t\tconst options = useMemo(\n\t\t\t\t() =>\n\t\t\t\t\tincludeVariationsInInserterItems( filteredItems ).map(\n\t\t\t\t\t\t( blockItem ) => {\n\t\t\t\t\t\t\tconst { title, icon, isDisabled } = blockItem;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tkey: `block-${ blockItem.id }`,\n\t\t\t\t\t\t\t\tvalue: blockItem,\n\t\t\t\t\t\t\t\tlabel: (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\tkey=\"icon\"\n\t\t\t\t\t\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\t\t\t\t\t\tshowColors\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{ title }\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tisDisabled,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t[ filteredItems ]\n\t\t\t);\n\n\t\t\treturn [ options ];\n\t\t},\n\t\tallowContext( before, after ) {\n\t\t\treturn ! ( /\\S/.test( before ) || /\\S/.test( after ) );\n\t\t},\n\t\tgetOptionCompletion( inserterItem ) {\n\t\t\tconst { name, initialAttributes, innerBlocks } = inserterItem;\n\t\t\treturn {\n\t\t\t\taction: 'replace',\n\t\t\t\tvalue: createBlock(\n\t\t\t\t\tname,\n\t\t\t\t\tinitialAttributes,\n\t\t\t\t\tcreateBlocksFromInnerBlocksTemplate( innerBlocks )\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t};\n}\n\n/**\n * Creates a blocks repeater for replacing the current block with a selected block type.\n *\n * @return {WPCompleter} A blocks completer.\n */\nexport default createBlockCompleter();\n"]}